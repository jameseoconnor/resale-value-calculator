{% extends "resale_app/base.html" %} {% block content %}

<style>
    /* Hide all except first fieldset*/

    #search fieldset:not(:first-of-type) {
        display: none;
    }
</style>

<div class="row justify-content-md-center m-5">
    <div class="d-flex justify-content-center">
        <h1>Find the best resale price for your pre-loved clothes!</h1>
    </div>
</div>

<form id="search" action="./search_result/" , method="post">
    {% csrf_token %}
    <div class="row justify-content-md-center m-10 form-inline">
        <div class="col-sm-6 search_form">
            <fieldset>
                <select class="form-control form-control-lg" id="brand_search" name="brand" autocomplete="True">
                    <option value="" disabled selected>Select Brand...</option>
                    {% for brand in available_brands %}
                    <option>{{ brand.brand_name|title }}</option>
                    {% endfor %}
                </select>
                <input type="button" class="btn btn-dark btn-lg mt-2 next" value="Next" />
            </fieldset>
            <fieldset>
                <select class="form-control form-control-lg" id="available_categories" name="category">
                    <option value="" disabled selected>Select Category...</option>
                </select>
                <input type="submit" class="btn btn-dark btn-lg mt-2 submit" value="Let's go!" />
            </fieldset>
        </div>
    </div>
</form>

<button onclick="window.location.reload();" id="new_search" class="btn btn-dark btn-lg mt-2">New Search</button>
<hr>

<div class="row justify-content-md-center m-5">
    <div class="col-10">
        <h3>Popular Searches</h3>
        {% for brand in available_brands %}
        <input type="button" id="popular_brand_search" class="btn btn-dark btn-lg mt-2 next"
            value="{{ brand.brand_name|upper }}" /> {% endfor %}
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

<script>
$('.next').click(function () {
    brand = $("#brand_search").val() || $("#popular_brand_search").val()
    var options = {};
    options.type = "GET";
    options.url = "ajax/get_categories_available/";
    options.type = "GET";
    options.data = {
        "brand": brand
    };
    options.dataType = "json";
    options.success = function (data) {
        if (data.length == 0) {
                $(".search_form").empty();
                $(".search_form").append("<h2>Sorry, we don't have any data on " + brand + " right now :( </h2>");
                $("#new_search").show();
                return
            }

            for (var i = 0; i < data.length; i++) {
            $("#available_categories").append("<option>" + data[i] + "</option>");
        }
    }

    $.ajax(options);

    var current_fs, next_fs, previous_fs; //fieldsets

    current_fs = $(this).parent();
    next_fs = $(this).parent().next();

    current_fs.hide();
    next_fs.show();
});

</script>


{% endblock %}